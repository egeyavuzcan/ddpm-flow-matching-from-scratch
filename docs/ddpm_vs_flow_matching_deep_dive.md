# DDPM vs Flow Matching: Step-by-Step Comparison with 2Ã—2 Matrices

In this document, we compare DDPM and Flow Matching methods using **2Ã—2 matrices**. Since latent tensors used in real diffusion models are high-dimensional, 2Ã—2 matrices serve as an ideal starting point for understanding these concepts.

---

## ğŸ“š Reference Papers

| Paper | Link |
|-------|------|
| **DDPM** | [Ho et al., 2020 - arXiv:2006.11239](https://arxiv.org/abs/2006.11239) |
| **Flow Matching** | [Lipman et al., 2022 - arXiv:2210.02747](https://arxiv.org/abs/2210.02747) |

---

## ğŸ“¦ Initial Values

We will use the same 2Ã—2 matrices for both methods:

```
Xâ‚€ = Clean Data (e.g., latent from VAE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0.8    0.4  â”‚
â”‚ 0.2    0.6  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Îµ = Gaussian Noise ~ N(0, I)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -0.6   0.3  â”‚
â”‚  0.5  -0.4  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ğŸ”µ DDPM (Denoising Diffusion Probabilistic Models)

## Core Formulas

### Forward Process
```
x_t = âˆšá¾±_t Â· x_0 + âˆš(1 - á¾±_t) Â· Îµ
```

### Reverse Process
```
Î¼_Î¸(x_t, t) = (1/âˆšÎ±_t) Ã— (x_t - (Î²_t/âˆš(1-á¾±_t)) Ã— Îµ_Î¸(x_t, t))
```

### Training Loss
```
L = || Îµ - Îµ_Î¸(x_t, t) ||Â²
```

---

## ğŸ§® DDPM Training Iteration (t=700/1000)

### Step 1: Noise Schedule Parameters

```
t = 700, T = 1000

Computed values:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ á¾±_700 = 0.05                                â”‚
â”‚ âˆšá¾±_700 = 0.2236                             â”‚
â”‚ âˆš(1-á¾±_700) = 0.9747                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: Forward Process - Creating Noisy Sample

**Formula:** `x_t = âˆšá¾±_t Â· x_0 + âˆš(1 - á¾±_t) Â· Îµ`

We compute each element separately:

```
Xâ‚€:                    Îµ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0.8    0.4  â”‚        â”‚ -0.6   0.3  â”‚
â”‚ 0.2    0.6  â”‚        â”‚  0.5  -0.4  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

X_700 = 0.2236 Ã— Xâ‚€ + 0.9747 Ã— Îµ

Position [0,0]: 0.2236 Ã— 0.8 + 0.9747 Ã— (-0.6) = 0.179 - 0.585 = -0.406
Position [0,1]: 0.2236 Ã— 0.4 + 0.9747 Ã— (0.3)  = 0.089 + 0.292 =  0.381
Position [1,0]: 0.2236 Ã— 0.2 + 0.9747 Ã— (0.5)  = 0.045 + 0.487 =  0.532
Position [1,1]: 0.2236 Ã— 0.6 + 0.9747 Ã— (-0.4) = 0.134 - 0.390 = -0.256

X_700 (Noisy Latent):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -0.406  0.381 â”‚
â”‚  0.532 -0.256 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 3: Model Forward Pass

The model takes X_700 and t=700 to predict noise:

```
Model Input:  X_700, t=700
Model Output: ÎµÌ‚ (predicted noise)

Output from a not-yet-well-trained model:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -0.45   0.25 â”‚
â”‚  0.40  -0.35 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 4: Loss Computation (MSE)

**Formula:** `L = (1/n) Ã— Î£(Îµ - ÎµÌ‚)Â²`

```
Ground Truth Îµ:          Model Prediction ÎµÌ‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -0.6   0.3  â”‚          â”‚ -0.45  0.25 â”‚
â”‚  0.5  -0.4  â”‚          â”‚  0.40 -0.35 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Error = Îµ - ÎµÌ‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -0.15    0.05     â”‚
â”‚  0.10   -0.05     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ErrorÂ²:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0.0225   0.0025   â”‚
â”‚ 0.0100   0.0025   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Loss = mean(ErrorÂ²) = (0.0225 + 0.0025 + 0.0100 + 0.0025) / 4
     = 0.0375 / 4
     = 0.0094
```

### Step 5: Gradient Computation

Gradient for MSE loss:

```
âˆ‚L/âˆ‚ÎµÌ‚ = (2/n) Ã— (ÎµÌ‚ - Îµ)

âˆ‚L/âˆ‚ÎµÌ‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  0.075   -0.025   â”‚
â”‚ -0.050    0.025   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

These gradients are propagated back to the model weights via backpropagation.
```

---

## ğŸ”„ DDPM Inference (t: 700 â†’ 699)

### Reverse Step Formula

```
Î¼ = (1/âˆšÎ±_t) Ã— (x_t - (Î²_t/âˆš(1-á¾±_t)) Ã— ÎµÌ‚)
x_{t-1} = Î¼ + Ïƒ_t Ã— z
```

### Computation

```
Parameters:
Î²_700 = 0.014
Î±_700 = 0.986
âˆšÎ±_700 = 0.993
Î²_700/âˆš(1-á¾±_700) = 0.014/0.9747 = 0.0144

Well-trained model prediction ÎµÌ‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -0.58   0.29 â”‚
â”‚  0.48  -0.39 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Mean computation (for each position):

[0,0]: Î¼ = (1/0.993) Ã— (-0.406 - 0.0144 Ã— (-0.58))
         = 1.007 Ã— (-0.406 + 0.0084)
         = 1.007 Ã— (-0.398)
         = -0.401

[0,1]: Î¼ = 1.007 Ã— (0.381 - 0.0144 Ã— 0.29)
         = 1.007 Ã— (0.381 - 0.0042)
         = 1.007 Ã— 0.377
         = 0.380

[1,0]: Î¼ = 1.007 Ã— (0.532 - 0.0144 Ã— 0.48)
         = 1.007 Ã— (0.532 - 0.0069)
         = 1.007 Ã— 0.525
         = 0.529

[1,1]: Î¼ = 1.007 Ã— (-0.256 - 0.0144 Ã— (-0.39))
         = 1.007 Ã— (-0.256 + 0.0056)
         = 1.007 Ã— (-0.250)
         = -0.252

X_699:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -0.401  0.380 â”‚
â”‚  0.529 -0.252 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Change: X_700 â†’ X_699 (very small!)
This is why 1000 steps are required.
```

---

# ğŸŸ¢ Flow Matching

## Core Formulas

### Probability Path (Linear Interpolation)
```
x_t = (1 - t) Â· x_0 + t Â· x_1
```

### Target Velocity
```
u_t = x_1 - x_0
```

### Training Loss
```
L = || v_Î¸(x_t, t) - u_t ||Â²
```

---

## ğŸ§® Flow Matching Training Iteration (t=0.7)

### Notation

In Flow Matching notation:
- `x_0` = data (clean latent) 
- `x_1` = noise

```
Xâ‚€ = Data:              Xâ‚ = Noise:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0.8    0.4  â”‚         â”‚ -0.6   0.3  â”‚
â”‚ 0.2    0.6  â”‚         â”‚  0.5  -0.4  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 1: Creating Noisy Sample

**Formula:** `x_t = (1 - t) Â· x_0 + t Â· x_1`

```
t = 0.7
(1-t) = 0.3
t = 0.7

X_t = 0.3 Ã— Xâ‚€ + 0.7 Ã— Xâ‚

Position [0,0]: 0.3 Ã— 0.8 + 0.7 Ã— (-0.6) = 0.24 - 0.42 = -0.18
Position [0,1]: 0.3 Ã— 0.4 + 0.7 Ã— (0.3)  = 0.12 + 0.21 =  0.33
Position [1,0]: 0.3 Ã— 0.2 + 0.7 Ã— (0.5)  = 0.06 + 0.35 =  0.41
Position [1,1]: 0.3 Ã— 0.6 + 0.7 Ã— (-0.4) = 0.18 - 0.28 = -0.10

X_t (Noisy Sample):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -0.18   0.33 â”‚
â”‚  0.41  -0.10 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: Target Velocity Computation

**Formula:** `u_t = x_1 - x_0`

```
U = Xâ‚ - Xâ‚€

Position [0,0]: -0.6 - 0.8 = -1.4
Position [0,1]:  0.3 - 0.4 = -0.1
Position [1,0]:  0.5 - 0.2 =  0.3
Position [1,1]: -0.4 - 0.6 = -1.0

Target Velocity U:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -1.4   -0.1 â”‚
â”‚  0.3   -1.0 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

This velocity is INDEPENDENT of t - it only depends on endpoints!
```

### Step 3: Model Forward Pass

```
Model Input:  X_t, t=0.7
Model Output: VÌ‚ (predicted velocity)

Output from a not-yet-well-trained model:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -1.2   -0.05 â”‚
â”‚  0.25  -0.85 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 4: Loss Computation (MSE)

**Formula:** `L = (1/n) Ã— Î£(u - vÌ‚)Â²`

```
Target U:                 Prediction VÌ‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -1.4  -0.1  â”‚          â”‚ -1.2  -0.05 â”‚
â”‚  0.3  -1.0  â”‚          â”‚  0.25 -0.85 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Error = U - VÌ‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ -0.20   -0.05     â”‚
â”‚  0.05   -0.15     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ErrorÂ²:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0.0400   0.0025   â”‚
â”‚ 0.0025   0.0225   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Loss = mean(ErrorÂ²) = (0.0400 + 0.0025 + 0.0025 + 0.0225) / 4
     = 0.0675 / 4
     = 0.0169
```

### Step 5: Gradient Computation

```
âˆ‚L/âˆ‚VÌ‚ = (2/n) Ã— (VÌ‚ - U)

âˆ‚L/âˆ‚VÌ‚:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  0.10    0.025    â”‚
â”‚ -0.025   0.075    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flow Matching Inference (20 steps)

### Euler ODE Solver

```
x_{t-Î”t} = x_t - v_Î¸(x_t, t) Ã— Î”t
```

### Example: First 3 Steps

```
Î”t = 1.0 / 20 = 0.05
Start: X_1.0 = Xâ‚ (pure noise)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: t=1.0 â†’ t=0.95                                          â”‚
â”‚                                                                 â”‚
â”‚ VÌ‚ = model(X_1.0, 1.0):    (well-trained)                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚ â”‚ -1.38  -0.09 â”‚                                                â”‚
â”‚ â”‚  0.28  -0.98 â”‚                                                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚                                                                 â”‚
â”‚ X_0.95 = X_1.0 - VÌ‚ Ã— 0.05                                      â”‚
â”‚                                                                 â”‚
â”‚ [0,0]: -0.6 - (-1.38) Ã— 0.05 = -0.6 + 0.069 = -0.531           â”‚
â”‚ [0,1]:  0.3 - (-0.09) Ã— 0.05 =  0.3 + 0.0045 = 0.305           â”‚
â”‚ [1,0]:  0.5 - (0.28) Ã— 0.05  =  0.5 - 0.014 = 0.486            â”‚
â”‚ [1,1]: -0.4 - (-0.98) Ã— 0.05 = -0.4 + 0.049 = -0.351           â”‚
â”‚                                                                 â”‚
â”‚ X_0.95:                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚ â”‚ -0.531  0.305 â”‚                                               â”‚
â”‚ â”‚  0.486 -0.351 â”‚                                               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 2: t=0.95 â†’ t=0.90                                         â”‚
â”‚                                                                 â”‚
â”‚ VÌ‚ = model(X_0.95, 0.95):                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚ â”‚ -1.36  -0.09 â”‚                                                â”‚
â”‚ â”‚  0.28  -0.97 â”‚                                                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚                                                                 â”‚
â”‚ X_0.90 = X_0.95 - VÌ‚ Ã— 0.05                                     â”‚
â”‚                                                                 â”‚
â”‚ X_0.90:                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚ â”‚ -0.463  0.310 â”‚                                               â”‚
â”‚ â”‚  0.472 -0.303 â”‚                                               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 3: t=0.90 â†’ t=0.85                                         â”‚
â”‚                                                                 â”‚
â”‚ VÌ‚ = model(X_0.90, 0.90):                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚ â”‚ -1.35  -0.09 â”‚                                                â”‚
â”‚ â”‚  0.27  -0.96 â”‚                                                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚                                                                 â”‚
â”‚ X_0.85:                                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚ â”‚ -0.396  0.315 â”‚                                               â”‚
â”‚ â”‚  0.459 -0.255 â”‚                                               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ... (17 more steps) ...                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 20: t=0.05 â†’ t=0.00                                        â”‚
â”‚                                                                 â”‚
â”‚ X_0.05 â‰ˆ                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚ â”‚  0.73   0.39 â”‚                                                â”‚
â”‚ â”‚  0.21   0.55 â”‚                                                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚                                                                 â”‚
â”‚ VÌ‚ = model(X_0.05, 0.05) â‰ˆ U (close to target velocity)        â”‚
â”‚                                                                 â”‚
â”‚ X_0.00 (Final - Clean Data):                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚ â”‚  0.80   0.40 â”‚  â† We reached the original Xâ‚€! âœ“              â”‚
â”‚ â”‚  0.20   0.60 â”‚                                                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ğŸ“Š Comparison Table

| Feature | DDPM | Flow Matching |
|---------|------|---------------|
| **Noisy Sample** | `x_t = âˆšá¾±_tÂ·x_0 + âˆš(1-á¾±_t)Â·Îµ` | `x_t = (1-t)Â·x_0 + tÂ·x_1` |
| **t Range** | 0 â†’ 1000 (discrete) | 0 â†’ 1 (continuous) |
| **Model Output** | Noise `Îµ_Î¸` | Velocity `v_Î¸` |
| **Target** | `Îµ` (noise) | `x_1 - x_0` (velocity) |
| **Loss** | `â€–Îµ - Îµ_Î¸â€–Â²` | `â€–v_Î¸ - (x_1-x_0)â€–Â²` |
| **Inference Steps** | ~1000 | ~20-50 |
| **Step Formula** | Complex (mean + variance) | Simple: `x -= vÂ·Î”t` |

---

## ğŸ”¢ Numerical Summary

```
With the same 2Ã—2 input matrices:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DDPM (t=700/1000)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Training Loss: 0.0094                                           â”‚
â”‚ Inference: Change from 700â†’699 is very small                   â”‚
â”‚ Total inference: 1000 steps required                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Flow Matching (t=0.7)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Training Loss: 0.0169                                           â”‚
â”‚ Inference: Significant progress at each step                    â”‚
â”‚ Total inference: 20 steps sufficient                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ Key Differences

### 1. Prediction Target

```
DDPM:         "What noise Îµ created X_t?"
              â†’ Model predicts noise matrix

Flow Matching: "What is the velocity from X_t to Xâ‚€?"
              â†’ Model predicts velocity matrix
```

### 2. Interpolation Method

```
DDPM:  [Xâ‚€] ----âˆšá¾±_t scaling---- [X_t] ----âˆš(1-á¾±_t) scaling---- [Îµ]
       Complex, non-linear coefficients

Flow:  [Xâ‚€] --------(1-t)-------- [X_t] ---------(t)----------- [Xâ‚]
       Simple linear interpolation
```

### 3. Inference Speed

```
DDPM:         X_1000 â†’ X_999 â†’ X_998 â†’ ... â†’ X_1 â†’ X_0
              Very small change at each step, 1000 steps required

Flow Matching: X_1.0 â†’ X_0.95 â†’ X_0.90 â†’ ... â†’ X_0.05 â†’ X_0.0
              Large steps with velocity, 20 steps sufficient
```

---

## ğŸ¯ Conclusion

As we observed with 2Ã—2 matrices:

- **DDPM**: Separate noise prediction for each position, complex reverse formula
- **Flow Matching**: Velocity prediction for each position, simple ODE step

When these properties are scaled to high-dimensional latent tensors (e.g., 64Ã—64Ã—4), the speed advantage of Flow Matching becomes even more significant.
